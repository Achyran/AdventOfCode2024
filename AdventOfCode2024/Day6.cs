using System;
using System.Collections.Generic;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Text;
using System.Threading.Tasks;

namespace AdventOfCode2024
{
    internal class Day6 : IDay
    {
        public string input => "................#......#...........#...........................#......#...........#........................................#......\r\n.......................................................................................#........#............#.............#.....#\r\n#.......................#...#..........#...........#........#.......................#............#................................\r\n.............#...............................................#........#................................#....#......#..............\r\n...#..................................#......................#....#....................................#.................#........\r\n...................#.....#......#...........#............................#......................#.#........................#......\r\n...........................#..#...........#.............................#.........#.##.............#..............................\r\n.#.................#................#..........##.........##..............#...................................................#...\r\n...............................#......................#........#.......................#.........#...........#....................\r\n...................................#................#.............................................................................\r\n..#...............##.......#................#.#......#...........#................................................................\r\n....#.#.....#..............#........##........................##...........................................#...............#......\r\n.....................#..........#.................................#.....................................#.........................\r\n..............#.........................................##......#.......................#..............#.................#..#.....\r\n...........#...#..........................................................#.......#.............................#................#\r\n................................#.#...............#...............................#..............##...............................\r\n.........................................................#............#......................................#.................#..\r\n......#.#....#.................................#....###..................#......#.........#....#..................................\r\n..............#...................................#..........#............#.......#...............................................\r\n..............#......#...............#.............................................#.............................................#\r\n....#.#..............#................#......................................................................#....................\r\n........................................................#...........#..#.#.....................#....#.....#........#...#.......#..\r\n..............#.......#................#............................#..#.......#.........#...........#...#...#....#....#.....#....\r\n...#...............................................................................................#..#..#..........#.............\r\n.......#.........#..###..................................##...............##..#.......................#..........#...........#...#\r\n.......#.....................#.............#...........#...............................................#.................#........\r\n..........#............................#..............................#......#..#.........#...............................#.......\r\n.............................#...............#............#..............................................................#........\r\n...........#...................#......#......................#.......................#...............#......#.....................\r\n..#..............................................#.........................#.............#...#.#..................................\r\n................#.............................#....................................#.....#...................#..#.....#...........\r\n#............................#...#........................#................#....#.............................................#...\r\n...............#.............#........#...................................................................#.......#....#..#.......\r\n...........#......#.....#........................#.#..........................................#............#......................\r\n.#.....................................................#...............#.........................#................#...........#...\r\n.........................................#.............#......#.#....................................................#.........#..\r\n................................#...#......................................................#..........................#..........#\r\n.#.........................#..............#.#.....................................................................................\r\n.........#..........#.............##.........#..#.................#........................#.....#.##....................#........\r\n...................................................................................#...........................................#..\r\n................#..........................................#...#...#.................................................#.........#..\r\n..............................................#..............#..................#......#...#....#..#..............................\r\n......#......#.................#.............#..................#...............#.............#..................#...............#\r\n.................................#.......#......#.......#.............................................................#........#..\r\n..................#......#...................................#.................#.......#..........................................\r\n....................#.........#.........................#..........#..........#..................#................................\r\n..........#...........#...............#.#..................................................................................#......\r\n..................#..#....................................................#..........#......#................................#....\r\n............#.................................................................................................#........#..........\r\n.........#...............................................#.........##...........................#.................................\r\n...#.........#........................................................#....................................#......................\r\n........#......................#......#............#........#...............#.......................#.............................\r\n.......#..............................................................................................#....................#......\r\n.#.#..........#.......#.............##......................#..........................................................#..........\r\n............#.#...........#............................................................#..........................................\r\n............#..........................................................................#....................#...............#.....\r\n.......................#.....#...#........................................#.......#.........#.........................#...........\r\n....................#..............#......#.......................................................................................\r\n......................#....................................................................#...............#...#............#.....\r\n........#..........#....................#...#........#......#..........................#....#..................#..#...............\r\n................#...........................................................................................................#.....\r\n.#...............#..........................................................................................#......#..#.#.........\r\n..............#................#...............#.........#.........#................................#.#...........................\r\n...#................#..............#........................#...#.......................................#.#.......................\r\n#.........................................#..#....................................................................#...............\r\n.............#...........#.......#.#.....................................................................#.....#..................\r\n.............#..............................................................................#.....................................\r\n........................#........#....#........#.#.............................................^..........#.......................\r\n...............................#.......................................................#.............##.......#.......#...........\r\n#.#..............#..........................................#.......#..........................................#..................\r\n...##...............................#........#.............##..................................................#..................\r\n..#..#.................................................................#............#...#...#.....................................\r\n....................#.#...#............#.......#.............#.......#..............#.............................................\r\n..#..#.........#.............................................................................#......................#...#.........\r\n....................................................#.........................#..#...#.#.#......#...............................#.\r\n......#.....#.....................................................................#..............................................#\r\n....................#........#..........................................................#.......#........................#........\r\n................#.........................#...........................#...........................................#..............#\r\n..#.......#..................................................#..................................#.................................\r\n..........#.....................#...#.#...........#....................................#..........................................\r\n.....................................#...........................................................#..........#...................#.\r\n....#............................#.........................................#.........................#............................\r\n......#............#...........#......#.#..................................#......................................................\r\n..................#.......#.....#......#.................................................................#................#.......\r\n...........#.....#........................................................#.............#.........................................\r\n.................................#...........................#........#.........#............#.............................#.....#\r\n..#........................#.................................#....................................................................\r\n......................................................................................................#........#.#...#............\r\n#............................#..........#.#.....................#.............................................................#...\r\n.......#.......#................#..........#..........................#........#....#...#........................................#\r\n....#.....#..........................................................#.........................#....................#..#.......#..\r\n.......#.............#.................................#...................................................................#......\r\n...............#.......................................#.#...............................#.#..........#...........................\r\n....#......#...#.#.........................#...............#...........#.......#........................................#..#......\r\n...................#.........................................#.....................................................#..#.....#...#.\r\n....#......#.#.............................#..........##........#......................#.#.......................#....#...........\r\n........#.........................#........#.#..........................##..............#....#....................................\r\n.............#.....#..........#.....#.......#..##...#.....................#..................................#....................\r\n....#....#...........................#...........#....................#.....#.......#....#.........#.....#....#...................\r\n............#...#....................#..........#.......#......#............#.........................#............##.............\r\n.....................#.................................................................####.......................................\r\n...#...........................................................................#......#..............#....#.......#...............\r\n....#...#...#.....................#.............#..............................#...................#...........#..................\r\n............................#...........#........#.............#..................................................................\r\n...#.....#......#.....................#...........................................#...........#........#..........................\r\n.................#...........................#................................................................#..........#........\r\n.....................#........#...#...................................................................................#......#....\r\n.#...............................#...#....#.................#...#......#..........................................................\r\n....................#..........#.........................................#....................#.........#.........................\r\n.......#.............#............#................#..........#.#.#.....................#............#.....................#......\r\n......................#.........................#.................#...........................#................#..................\r\n...#....#..........................#.#..##.................#..#..........#..............................................#.........\r\n...........#.........................................................................................#.............#..............\r\n..............#.................##...........#..#.............................................#..............................#....\r\n...............................................##.......#..#.....#........#...#.............#.....................#...............\r\n........#...................#...........#...............................#............................................#........#...\r\n...................................#.....#......................#...#.........##..#...................#.#.........................\r\n............#...........##............#.......................#.....#.......#...................#.................................\r\n..#..#..............................#.......#.........#.....................................#.............#..#.................#..\r\n..................#..................#..........................##..................#...#.......#.........#..................#....\r\n.........#.........#..............................................#...........................................................#...\r\n......................#...........#..................................#............................#......#.....#..................\r\n.....#....#......#..................#.....#..............#.............................................#.....#....................\r\n..............##...........#........................................................................#........#.#..................\r\n..........#...............................##.......#............#.#.........#.....................................#....#..........\r\n.................................#..............#.............................#........................................#..........\r\n....................#.................#..........#..............#.......................#...................................#.....\r\n............#..............................#.............................#......#......#......................#...#...............\r\n.#..........#...............#..................................................................#....#.............................\r\n....#............................................#......#..................#.....#............#.........................#.........";

        public string example => "....#.....\r\n.........#\r\n..........\r\n..#.......\r\n.......#..\r\n..........\r\n.#..^.....\r\n........#.\r\n#.........\r\n......#...";

        enum Dir
        {
            up,down,left,right
        }


        public string Run(bool UseInput = true)
        {
            Board board = UseInput? new Board(input) : new Board(example);
            //board.Draw();

            Vec2 pos = board.start;
            Dir dir = Dir.up;


            while (board.IsInBount(pos)) 
            {
                if (board.GetChar(Vec2.Move(pos, dir)) == 'X')
                { 
                    if(board.IsInBount( Vec2.Move( Vec2.Move(pos, dir), dir)))
                    {
                        board.NewObstical(Vec2.Move(Vec2.Move(pos, dir), dir));
                    }
                }

                if (board.GetChar(Vec2.Move(pos,dir)) == '#')
                {
                    dir = NextDir(dir);
                }
                board.Passed(pos);
                pos = Vec2.Move(pos, dir);

                Thread.Sleep(100);
                board.Draw();


            }


            return board.XAmount().ToString();
        }

        Dir NextDir(Dir dir) {

            switch (dir)
            {
                case Dir.up:
                    return Dir.right;
                case Dir.down:
                    return Dir.left;
                case Dir.left:
                    return Dir.up;
                case Dir.right:
                    return Dir.down;

            }
            throw new InvalidDataException();

        }

        public string Run2(bool UseInput = true)
        {
            throw new NotImplementedException();
        }

        private class Board
        {
            public char[,] content;
            public int height;
            public int width;
            public Vec2 start;


            public Board(string input)
            {
                start = new Vec2 (0, 0);
                string[] splitInput = input.Split("\r\n");

                height = splitInput.Count();
                width = splitInput[0].Length;


                content = new char[splitInput.Count(),splitInput[0].Length];
                for (int y = 0; y < splitInput.Length; y++) 
                { 
                    for (int x = 0; x < splitInput[0].Length; x++)
                    {
                        if(splitInput[y][x] == '^') 
                            start = new Vec2(x, y);

                        content[x, y] = splitInput[y][x];
                    }
                }
            }

            public void Passed(Vec2 pos)
            {

                if (content[pos.x, pos.y] == '+') return;
                content[pos.x, pos.y] = 'X';
            }

            public void NewObstical(Vec2 pos)
            {
                content[pos.x, pos.y] = '+';
            }

            public char GetChar(Vec2 pos)
            {
                if(!IsInBount(pos)) return ' ';

                return content[pos.x, pos.y];
            }

            public void Draw() 
            { 
                Console.Clear();
                for (int y = 0; y < height; y++) {
                    for (int x = 0; x < width; x++) {
                        Console.Write(content[x, y]);
                    }
                    Console.WriteLine();
                }
            }

            public int XAmount()
            {
                int counter = 0;
                for (int y = 0; y < height; y++)
                {
                    for (int x = 0; x < width; x++)
                    {
                        if (content[x,y] == 'X') counter++;
                    }
                }
                return counter;
            }

            

            public bool IsInBount(Vec2 pos)
            {
                return pos.x >= 0 && pos.x < width
                    && pos.y >= 0 && pos.y < height;
            }

        }

        private class Vec2
        {
            public int x; 
            public int y;

            public Vec2(int x, int y) 
            {
                this.x = x;
                this.y = y;
            }

            public static Vec2 Move(Vec2 pos, Dir dir) 
            {
                switch (dir)
                {
                    case Dir.up:
                        return new Vec2( pos.x, pos.y-1 );
                    case Dir.down:
                        return new Vec2(pos.x, pos.y +1);
                    case Dir.left:
                        return new Vec2(pos.x -1, pos.y);
                    case Dir.right:
                        return new Vec2(pos.x +1, pos.y );
                }

                throw new InvalidDataException();
            }
        }
    }
}
